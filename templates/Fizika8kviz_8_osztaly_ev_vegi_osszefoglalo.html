<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fizika 8. Oszt√°ly - √âv V√©gi √ñsszefoglal√≥ Kv√≠z</title>
    <link rel="stylesheet" href="static/css/stilus.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; min-height: 100vh; padding-top: 80px; transition: background-color 0.3s ease, color 0.3s ease; }
        #bg-video { position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -2; opacity: 0.8; filter: brightness(0.7); }
        .hidden { display: none !important; }
        body.dark-mode { background-color: #1a1a2e; color: #e0e0e0; }
        body.dark-mode .header, body.dark-mode .question-block, body.dark-mode .option, body.dark-mode .explanation, body.dark-mode .modal-content { background-color: rgba(45, 45, 68, 0.9); border-color: #4a4a66; color: #e0e0e0; }
        body.dark-mode .header h1, body.dark-mode .question-text, body.dark-mode .header p { color: #e0e0e0; }
        body.dark-mode .option:hover { background: rgba(78, 78, 105, 0.98); }
        body.dark-mode .option.selected { background: rgba(102, 126, 234, 0.9); border-color: #8396f5; }
        .controls { position: fixed; top: 90px; left: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
        .control-btn { width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2em; box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .control-btn:hover { transform: scale(1.1); }
        .zoom-btn { background: rgba(76, 175, 80, 0.8); color: white; }
        .theme-btn { background: rgba(255, 193, 7, 0.8); color: white; }
        .accessibility-toggle-btn { background: rgba(33, 150, 243, 0.8); color: white; }
        .accessibility-panel { position: fixed; top: 270px; left: 20px; background: rgba(255, 255, 255, 0.95); border-radius: 10px; padding: 15px; display: none; z-index: 1000; }
        .accessibility-panel.show { display: block; }
        .accessibility-btn { display: block; width: 100%; margin: 5px 0; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .speak-btn { background: #4CAF50; color: white; }
        .stop-speak-btn { background: #f44336; color: white; }
        body.high-contrast { filter: contrast(150%); }
        body.zoomed { font-size: 115%; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 40px; background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 15px; backdrop-filter: blur(10px); }
        .question-block { background: rgba(248, 249, 250, 0.95); border-radius: 12px; padding: 25px; margin-bottom: 30px; border-left: 5px solid #3498db; }
        .option { display: flex; align-items: center; padding: 15px; border-radius: 10px; border: 2px solid #e9ecef; cursor: pointer; transition: all 0.2s; }
        .option input[type="radio"] { display: none; }
        .option:hover { background: #e9f5ff; border-color: #2196F3; }
        .option.selected { background: #2196F3; color: white; border-color: #1976d2; }
        .option.correct { background: #4CAF50 !important; color: white !important; }
        .option.incorrect { background: #f44336 !important; color: white !important; }
        .explanation { margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; display: none; }
        .explanation.show { display: block; }
        #submit-btn { background: #6c5ce7; color: white; border: none; padding: 15px 40px; border-radius: 30px; cursor: pointer; font-size: 1.2em; }
        #submit-btn:disabled { background: #ccc; cursor: not-allowed; }
        .score-container { text-align: center; margin-top: 30px; display: none; padding: 20px; background: rgba(30, 60, 114, 0.95); color: white; border-radius: 15px; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: none; z-index: 2000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; text-align: center; color: #333; }
        body.dark-mode .modal-content { background: #2d2d44; color: #e0e0e0; }
        body.dark-mode .modal-content input { background: #1a1a2e; border-color: #4a4a66; color: white; }
        .modal-content button { color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; margin: 5px; font-weight: bold; }
        .modal-content .btn-primary { background: #2196F3; }
        .modal-content .btn-secondary { background: #6c757d; }
        #voice-controls-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2500; display: flex; align-items: center; justify-content: space-around; padding: 20px; }
        .voice-btn { width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; color: white; font-size: 1.5em; font-weight: bold; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .voice-btn .icon { font-size: 2em; margin-bottom: 5px; }
        .voice-btn.blue { background: #2196F3; }
        .voice-btn.yellow { background: #ffc107; }
        .voice-btn.red { background: #f44336; }
        .voice-mode-active-indicator { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #f44336; color: white; padding: 10px 20px; border-radius: 25px; z-index: 3000; display: none; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); } 100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); } }
        .accessibility-switch { display: flex; align-items: center; justify-content: space-between; margin-top: 10px; padding: 5px; background: #eee; border-radius: 5px; }
        .accessibility-switch label { font-size: 0.9em; }
    </style>
</head>
<body class="light-mode">
    
    {% include 'navigacio.html' %}
    <video autoplay muted loop id="bg-video"><source src="static/video/video.mp4" type="video/mp4"></video>

    <div class="modal" id="email-modal"><div class="modal-content"><h2>Sz√ºl≈ëi Fel√ºgyelet</h2><p>Add meg a sz√ºl≈ëi e-mail c√≠met az eredm√©nyek elk√ºld√©s√©hez.</p><input type="email" id="parent-email" placeholder="szulo@email.com"><div><button class="btn-primary" onclick="startQuizWithEmail()">Kv√≠z Ind√≠t√°sa</button><button class="btn-secondary" onclick="skipEmail()">Kihagy√°s</button></div></div></div>
    <div class="modal" id="achievement-modal"><div class="modal-content"><h2 id="achievement-title">Gratul√°lunk!</h2><p id="achievement-description">Sikeres teljes√≠t√©s!</p><button onclick="downloadCertificate()">Oklev√©l Let√∂lt√©se</button><button class="btn-secondary" onclick="closeAchievement()">Bez√°r√°s</button></div></div>
    <div class="modal" id="inactivity-warning"><div class="modal-content" style="background: #ff5722; color: white;"><h3>Inaktivit√°s √âszlelve</h3><p>A kv√≠z <span id="countdown">10</span> m√°sodperc m√∫lva √∫jraindul.</p><button onclick="resetInactivityTimer()" style="background: white; color: #ff5722;">Folytatom</button></div></div>

    <div class="controls"><button class="control-btn zoom-btn" id="zoom-btn" title="Nagy√≠t√°s">üîç</button><button class="control-btn theme-btn" id="theme-btn" title="T√©ma V√°lt√°s">üåô</button><button class="control-btn accessibility-toggle-btn" id="accessibility-btn" title="Kiseg√≠t≈ë lehet≈ës√©gek">‚ôø</button></div>
    <div class="accessibility-panel" id="accessibility-panel"><div class="accessibility-switch"><label for="visually-impaired-mode">L√°t√°ss√©r√ºlt M√≥d</label><input type="checkbox" id="visually-impaired-mode"></div><h4>Hangvez√©rl√©s</h4><button class="accessibility-btn speak-btn" onclick="startVoiceQuiz()">üé§ Ind√≠t√°s</button><button class="accessibility-btn stop-speak-btn" onclick="stopVoiceQuiz()">üõë Le√°ll√≠t√°s</button></div>
    <div class="voice-mode-active-indicator" id="voice-indicator">üé§ Hangvez√©rl√©s akt√≠v...</div>
    <div id="voice-controls-container" class="hidden"><button class="voice-btn blue" onclick="voiceCommand('ism√©teld')"><span class="icon">üîÑ</span>Ism√©tl√©s</button><button class="voice-btn yellow" id="pause-resume-btn" onclick="togglePauseResume()"><span class="icon">‚è∏Ô∏è</span>Sz√ºnet</button><button class="voice-btn red" onclick="stopVoiceQuiz()"><span class="icon">‚õî</span>Kil√©p√©s</button></div>

    <div class="container">
        <div class="header"><h1>üß™ Fizika 8. Oszt√°ly</h1><p>√âv V√©gi √ñsszefoglal√≥ Kv√≠z</p></div>
        <form id="quiz-form"></form>
        <div class="submit-container"><button type="button" id="submit-btn" disabled>Kv√≠z Lead√°sa</button></div>
        <div class="score-container" id="score-container"><h2>Eredm√©ny</h2><div>Helyes: <span id="correct-count">0</span>/25</div><div id="percentage">0%</div></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- ADATB√ÅZIS ---
        const quizData = [
            { question: "Mi az elektromos √°ram?", options: ["Elektronok rendezett mozg√°sa", "Protonok mozg√°sa", "Atomok rezg√©se", "F√©ny terjed√©se"], answer: 0, explanation: "Az elektromos √°ram az elektronok ir√°ny√≠tott mozg√°sa egy vezet≈ëben." }, { question: "Melyik az Ohm-t√∂rv√©ny helyes fel√≠r√°sa?", options: ["U = I √ó R", "U = I / R", "U = R / I", "U = I + R"], answer: 0, explanation: "Az Ohm t√∂rv√©ny kimondja, hogy a fesz√ºlts√©g egyenl≈ë az √°ramer≈ëss√©g √©s az ellen√°ll√°s szorzat√°val." }, { question: "Mi a f√©ny sebess√©ge v√°kuumban?", options: ["300 000 m/s", "3 000 000 m/s", "300 000 000 m/s", "30 000 000 m/s"], answer: 2, explanation: "A f√©ny sebess√©ge v√°kuumban k√∂r√ºlbel√ºl 300 000 000 m√©ter/m√°sodperc." }, { question: "Mit jelent a f√©nyt√∂r√©s?", options: ["F√©ny elnyel√©se", "F√©ny visszaver≈ëd√©se", "F√©ny ir√°nyv√°ltoz√°sa k√∂zegv√°lt√°skor", "F√©ny sz√©tsz√≥r√≥d√°sa"], answer: 2, explanation: "A f√©nyt√∂r√©s sor√°n a f√©nysug√°r ir√°nyt v√°ltoztat, amikor egyik k√∂zegb≈ël a m√°sikba l√©p." }, { question: "Mi a m√°gneses mez≈ë forr√°sa?", options: ["Mozg√≥ elektromos t√∂lt√©s", "√Åll√≥ elektromos t√∂lt√©s", "H≈ëm√©rs√©klet", "Nyom√°s"], answer: 0, explanation: "A m√°gneses mez≈ët mozg√≥ elektromos t√∂lt√©sek hozz√°k l√©tre." }, { question: "Melyik √°ll√≠t√°s igaz a hull√°mokra?", options: ["Csak leveg≈ëben terjednek", "Energia n√©lk√ºl terjednek", "Energi√°t sz√°ll√≠tanak", "Mindig ugyanolyan sebess√©ggel terjednek"], answer: 2, explanation: "A hull√°mok energi√°t sz√°ll√≠tanak an√©lk√ºl, hogy anyagot sz√°ll√≠tan√°nak." }, { question: "Mi a hang sebess√©ge leveg≈ëben 20¬∞C-on?", options: ["343 m/s", "1500 m/s", "5000 m/s", "300 000 000 m/s"], answer: 0, explanation: "A hang sebess√©ge leveg≈ëben 20¬∞C-on k√∂r√ºlbel√ºl 343 m√©ter per szekundum." }, { question: "Mit m√©r a dinamom√©ter?", options: ["T√∂meget", "Er≈ët", "Sebess√©get", "Gyorsul√°st"], answer: 1, explanation: "A dinamom√©ter er≈ë m√©r√©s√©re szolg√°l√≥ m≈±szer." }, { question: "Mi a mechanikai energia?", options: ["Csak kinetikus energia", "Csak potenci√°lis energia", "Kinetikus √©s potenci√°lis energia √∂sszege", "H≈ëenergia"], answer: 2, explanation: "A mechanikai energia a kinetikus √©s potenci√°lis energia √∂sszege." }, { question: "Melyik eszk√∂z alak√≠tja √°t a mechanikai energi√°t elektromos energi√°v√°?", options: ["Motor", "Gener√°tor", "Transzform√°tor", "Kondenz√°tor"], answer: 1, explanation: "A gener√°tor (dinam√≥) alak√≠tja √°t a mechanikai energi√°t elektromos energi√°v√°." }, { question: "Mi t√∂rt√©nik a f√©nnyel, amikor s√≠kt√ºk√∂rre esik?", options: ["Teljesen elnyel≈ëdik", "T√∂rik", "Visszaver≈ëdik", "Sz√≥r√≥dik"], answer: 2, explanation: "A s√≠kt√ºk√∂r visszaveri a r√°es≈ë f√©nyt." }, { question: "Melyik lencse gy≈±jti a p√°rhuzamos f√©nysugarakat egy pontba?", options: ["Dombor√∫ lencse", "Homor√∫ lencse", "S√≠kt√ºk√∂r", "Prizma"], answer: 0, explanation: "A dombor√∫ (konvex) lencse gy≈±jti a p√°rhuzamos f√©nysugarakat egy pontba (f√≥kuszpontba)." }, { question: "Mi a h≈ëm√©rs√©klet SI m√©rt√©kegys√©ge?", options: ["Celsius fok", "Fahrenheit fok", "Kelvin", "Joule"], answer: 2, explanation: "A h≈ëm√©rs√©klet SI m√©rt√©kegys√©ge a Kelvin (K)." }, { question: "Melyik anyag a legjobb h≈ëvezet≈ë?", options: ["Fa", "M≈±anyag", "R√©z", "Leveg≈ë"], answer: 2, explanation: "A r√©z kiv√°l√≥ h≈ëvezet≈ë, sokkal jobb, mint a fa, m≈±anyag vagy leveg≈ë." }, { question: "Mi az elektromos teljes√≠tm√©ny k√©plete?", options: ["P = U √ó I", "P = U / I", "P = U + I", "P = U - I"], answer: 0, explanation: "Az elektromos teljes√≠tm√©ny egyenl≈ë a fesz√ºlts√©g √©s az √°ramer≈ëss√©g szorzat√°val." }, { question: "Melyik r√©szecske hordozza a negat√≠v elektromos t√∂lt√©st?", options: ["Proton", "Neutron", "Elektron", "Pozitron"], answer: 2, explanation: "Az elektron hordozza a negat√≠v elektromos t√∂lt√©st." }, { question: "Mi a gravit√°ci√≥s gyorsul√°s √©rt√©ke a F√∂ld√∂n?", options: ["9,8 m/s¬≤", "10 m/s¬≤", "9,8 m/s", "10 m/s"], answer: 0, explanation: "A gravit√°ci√≥s gyorsul√°s √©rt√©ke a F√∂ld√∂n k√∂r√ºlbel√ºl 9 eg√©sz 8 tized m√©ter per szekundum n√©gyzet." }, { question: "Melyik hull√°mfajta a f√©ny?", options: ["Mechanikai hull√°m", "Elektrom√°gneses hull√°m", "Hanghull√°m", "V√≠zhull√°m"], answer: 1, explanation: "A f√©ny elektrom√°gneses hull√°m, nem mechanikai hull√°m." }, { question: "Mi a spektroszk√≥pia?", options: ["Hangok elemz√©se", "F√©nyt√∂r√©s vizsg√°lata", "F√©nyspektrum elemz√©se", "H≈ëm√©rs√©klet m√©r√©se"], answer: 2, explanation: "A spektroszk√≥pia a f√©nyspektrum elemz√©s√©vel foglalkoz√≥ tudom√°ny√°g." }, { question: "Melyik eszk√∂zzel lehet elektromos fesz√ºlts√©get m√©rni?", options: ["Amperm√©terrel", "Voltm√©terrel", "Ohmm√©terrel", "Wattm√©terrel"], answer: 1, explanation: "A voltm√©r≈ë (voltm√©ter) elektromos fesz√ºlts√©g m√©r√©s√©re szolg√°l." }, { question: "Mi a Doppler-effektus?", options: ["F√©ny t√∂r√©se", "Hang magass√°g√°nak v√°ltoz√°sa mozg√°s miatt", "Elektromos vezet√©s", "M√°gneses t√©r v√°ltoz√°sa"], answer: 1, explanation: "A Doppler-effektus a hang magass√°g√°nak v√°ltoz√°sa a forr√°s √©s megfigyel≈ë relat√≠v mozg√°sa miatt." }, { question: "Melyik energia-√°talakul√°s t√∂rt√©nik a dinam√≥ban?", options: ["Elektromos ‚Üí mechanikai", "Mechanikai ‚Üí elektromos", "H≈ë ‚Üí elektromos", "K√©miai ‚Üí elektromos"], answer: 1, explanation: "A dinam√≥ mechanikai energi√°t alak√≠t √°t elektromos energi√°v√°." }, { question: "Mi a rezonancia?", options: ["F√©ny visszaver≈ëd√©se", "Hull√°mok er≈ës√≠t√©se azonos frekvenci√°n", "Elektromos r√∂vidz√°r", "H≈ëm√©rs√©klet emelked√©se"], answer: 1, explanation: "A rezonancia sor√°n a hull√°mok er≈ës√≠tik egym√°st, ha frekvenci√°juk megegyezik." }, { question: "Melyik √°ll√≠t√°s igaz a p√°rhuzamos kapcsol√°sra?", options: ["Az √°ram mindenhol egyforma", "A fesz√ºlts√©g mindenhol egyforma", "Az ellen√°ll√°s √∂sszead√≥dik", "Egy elem ki√©g√©se mindent le√°ll√≠t"], answer: 1, explanation: "P√°rhuzamos kapcsol√°sban a fesz√ºlts√©g minden √°gban ugyanakkora." }, { question: "Mi az infrav√∂r√∂s sug√°rz√°s?", options: ["L√°that√≥ f√©ny", "H≈ësug√°rz√°s", "R√∂ntgensug√°rz√°s", "R√°di√≥hull√°m"], answer: 1, explanation: "Az infrav√∂r√∂s sug√°rz√°s h≈ësug√°rz√°s, amelyet minden meleg test kibocs√°t." }
        ];

        // --- DOM ELEMEK √©s √ÅLLAPOTV√ÅLTOZ√ìK ---
        const form = document.getElementById('quiz-form'); const submitBtn = document.getElementById('submit-btn'); const voiceIndicator = document.getElementById('voice-indicator'); const voiceControls = document.getElementById('voice-controls-container'); const pauseResumeBtn = document.getElementById('pause-resume-btn'); const body = document.body; const emailModal = document.getElementById('email-modal'); const achievementModal = document.getElementById('achievement-modal'); const inactivityWarning = document.getElementById('inactivity-warning'); const countdownSpan = document.getElementById('countdown'); const zoomBtn = document.getElementById('zoom-btn'); const themeBtn = document.getElementById('theme-btn'); const accessibilityBtn = document.getElementById('accessibility-btn'); const accessibilityPanel = document.getElementById('accessibility-panel'); const accessibilityModeCheckbox = document.getElementById('visually-impaired-mode');
        let userAnswers = new Array(quizData.length).fill(null); let currentQuestionIndex = 0; let isVoiceModeActive = false; let waitingForConfirmation = false; let isPaused = false;
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; let recognition;

        // --- INICIALIZ√ÅL√ÅS ---
        function init() { loadQuestions(); attachEventListeners(); emailModal.classList.add('show'); }

        // --- HANGVEZ√âRL√âS ---
        window.startVoiceQuiz = function() {
            if (!SpeechRecognition) return alert("A b√∂ng√©sz≈ëd nem t√°mogatja a hangfelismer√©st.");
            recognition = new SpeechRecognition();
            recognition.lang = 'hu-HU'; recognition.continuous = false;
            recognition.onresult = handleVoiceResult;
            recognition.onerror = (event) => { if(event.error !== 'no-speech' && event.error !== 'aborted') console.error('Hangfelismer√©si hiba:', event.error); };
            recognition.onend = () => { if (isVoiceModeActive && !isPaused) startListening(); };
            isVoiceModeActive = true;
            voiceIndicator.style.display = 'block'; voiceControls.classList.remove('hidden'); currentQuestionIndex = 0;
            speakLines(getQuestionSpeechArray(0), startListening);
        };
        window.stopVoiceQuiz = function() { isVoiceModeActive = false; isPaused = false; if (recognition) recognition.stop(); speechSynthesis.cancel(); voiceIndicator.style.display = 'none'; voiceControls.classList.add('hidden'); };
        function speakLines(lines, onEndCallback, index = 0, rate = 0.9) {
            if (index >= lines.length) { if (onEndCallback) setTimeout(onEndCallback, 1200); return; }
            if (recognition && isVoiceModeActive) recognition.stop();
            const utterance = new SpeechSynthesisUtterance(lines[index]);
            utterance.lang = "hu-HU"; utterance.rate = rate;
            utterance.onend = () => { setTimeout(() => speakLines(lines, onEndCallback, index + 1, rate), 1500); };
            speechSynthesis.speak(utterance);
        }
        function startListening() { if (recognition && isVoiceModeActive && !isPaused) { try { recognition.start(); } catch(e) {} } }
        function getQuestionSpeechArray(index) {
            const item = quizData[index];
            const isAccessible = accessibilityModeCheckbox.checked;
            let questionText = `K√©rd√©s ${index + 1}. ${item.question}`;
            let options = item.options.map((opt, i) => {
                let textToRead = opt;
                if (isAccessible) { textToRead = textToRead.replace(/√ó/g, ' szorozva ').replace(/m\/s¬≤/g, 'm√©ter per szekundum n√©gyzet').replace(/m\/s/g, 'm√©ter per szekundum').replace(/300 000 000/g, 'h√°romsz√°zmilli√≥').replace(/3 000 000/g, 'h√°rommilli√≥').replace(/300 000/g, 'h√°romsz√°zezer').replace(/9,8/g, 'kilenc eg√©sz nyolc tized'); }
                return `V√°lasz ${String.fromCharCode(65 + i)}: ${textToRead}.`;
            });
            return [questionText, ...options];
        }
        function handleVoiceResult(event) { if(!isVoiceModeActive) return; recognition.stop(); const transcript = event.results[0][0].transcript.toLowerCase().trim().replace('.', ''); voiceCommand(transcript); }
        window.voiceCommand = function(command) {
            if (!isVoiceModeActive) return; vibrate();
            const answerMap = { 'a': 0, '√°': 0, 'b': 1, 'c': 2, 'd': 3 };
            if (waitingForConfirmation) { if (command.includes('igen')) nextQuestion(); else speakLines(["Rendben, v√°rom a tov√°bbi utas√≠t√°sokat."], startListening); waitingForConfirmation = false; return; }
            if (command in answerMap) handleAnswer(answerMap[command]);
            else if (command.includes('ism√©teld')) speakLines(getQuestionSpeechArray(currentQuestionIndex), startListening);
            else if (command.includes('k√∂vetkez≈ë')) nextQuestion();
            else if (command.includes('el≈ëz≈ë')) prevQuestion();
            else speakLines(["Ezt nem √©rtettem. K√©rlek, pr√≥b√°ld √∫jra."], startListening);
        }
        function handleAnswer(answerIndex) {
            userAnswers[currentQuestionIndex] = answerIndex; const radio = document.querySelector(`input[name="q${currentQuestionIndex}"][value="${answerIndex}"]`); if(radio) { radio.checked = true; handleOptionChange({ target: radio }); }
            const isCorrect = quizData[currentQuestionIndex].answer === answerIndex; updateQuestionUI(currentQuestionIndex, isCorrect);
            let feedback = [isCorrect ? "Helyes!" : "Helytelen.", `A magyar√°zat: ${quizData[currentQuestionIndex].explanation}.`, `K√©szen √°llsz a k√∂vetkez≈ë k√©rd√©sre? Mondd, hogy igen!`];
            waitingForConfirmation = true; speakLines(feedback, startListening);
        }
        function nextQuestion() { if (currentQuestionIndex < quizData.length - 1) { currentQuestionIndex++; speakLines(getQuestionSpeechArray(currentQuestionIndex), startListening); } else { speakLines(["El√©rted az utols√≥ k√©rd√©st.", "A kv√≠zt befejezem √©s ki√©rt√©kelem."], () => { stopVoiceQuiz(); handleSubmit(); }); } }
        function prevQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; speakLines(getQuestionSpeechArray(currentQuestionIndex), startListening); } else { speakLines(["Ez az els≈ë k√©rd√©s."], startListening); } }
        window.togglePauseResume = function() { isPaused = !isPaused; if (isPaused) { speechSynthesis.pause(); if (recognition) recognition.stop(); pauseResumeBtn.innerHTML = `<span class="icon">‚ñ∂Ô∏è</span>Folytat√°s`; } else { speechSynthesis.resume(); startListening(); pauseResumeBtn.innerHTML = `<span class="icon">‚è∏Ô∏è</span>Sz√ºnet`; } vibrate(); }
        function vibrate() { if (navigator.vibrate) navigator.vibrate(50); }

        // --- Hagyom√°nyos Kv√≠z √©s Vez√©rl≈ëk ---
        const scoreContainer = document.getElementById('score-container'); const zoomBtn = document.getElementById('zoom-btn'); const themeBtn = document.getElementById('theme-btn'); const accessibilityBtn = document.getElementById('accessibility-btn'); const accessibilityPanel = document.getElementById('accessibility-panel');
        function loadQuestions() { let html = quizData.map((item, index) => `<div class="question-block" id="q-block-${index}"><div class="question-text">${index + 1}. ${item.question}</div><div class="options">${item.options.map((option, i) => `<label class="option"><input type="radio" name="q${index}" value="${i}">${String.fromCharCode(65 + i)}. ${option}</label>`).join('')}</div><div class="explanation" id="explanation-${index}"><strong>Magyar√°zat:</strong> ${item.explanation}</div></div>`).join(''); form.innerHTML = html; }
        function attachEventListeners() { form.addEventListener('change', handleOptionChange); submitBtn.addEventListener('click', handleSubmit); zoomBtn.addEventListener('click', toggleZoom); themeBtn.addEventListener('click', toggleTheme); accessibilityBtn.addEventListener('click', () => accessibilityPanel.classList.toggle('show')); }
        function handleOptionChange(event) { if (event.target.type === 'radio') { const qIndex = parseInt(event.target.name.replace('q', '')); userAnswers[qIndex] = parseInt(event.target.value); document.querySelectorAll(`#q-block-${qIndex} .option`).forEach(opt => opt.classList.remove('selected')); event.target.parentElement.classList.add('selected'); checkAllAnswered(); resetInactivityTimer(); } }
        function checkAllAnswered() { submitBtn.disabled = !userAnswers.every(answer => answer !== null); }
        function handleSubmit() { let correctCount = 0; quizData.forEach((item, index) => { const isCorrect = item.answer === userAnswers[index]; if (isCorrect) correctCount++; updateQuestionUI(index, isCorrect); }); showFinalScore(correctCount); stopInactivityTimer(); }
        function updateQuestionUI(index, isCorrect) { const options = document.querySelectorAll(`#q-block-${index} .option`); const selectedOption = userAnswers[index] !== null ? options[userAnswers[index]] : null; if(selectedOption){ selectedOption.classList.add(isCorrect ? 'correct' : 'incorrect'); if (!isCorrect) { options[quizData[index].answer].classList.add('correct'); } } document.getElementById(`explanation-${index}`).classList.add('show'); options.forEach(opt => opt.style.pointerEvents = 'none'); }
        function showFinalScore(correctCount) { const total = quizData.length; const percentage = Math.round((correctCount / total) * 100); document.getElementById('correct-count').textContent = correctCount; document.getElementById('percentage').textContent = `${percentage}%`; scoreContainer.style.display = 'block'; submitBtn.disabled = true; if (percentage >= 50) achievementModal.classList.add('show'); }
        function toggleZoom() { body.classList.toggle('zoomed'); }
        function toggleTheme() { body.classList.toggle('dark-mode'); themeBtn.textContent = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô'; }
        window.startQuizWithEmail = () => { emailModal.classList.remove('show'); resetInactivityTimer(); };
        window.skipEmail = () => { emailModal.classList.remove('show'); resetInactivityTimer(); };
        window.closeAchievement = () => achievementModal.classList.remove('show');
        window.downloadCertificate = () => alert('Oklev√©l let√∂lt√©se...');
        window.toggleHighContrast = () => body.classList.toggle('high-contrast');
        
        // --- Inaktivit√°s ---
        let inactivityTimer, warningTimer;
        function resetInactivityTimer() { clearTimeout(inactivityTimer); clearTimeout(warningTimer); inactivityWarning.classList.remove('show'); inactivityTimer = setTimeout(() => showInactivityWarning(), 120000); }
        function stopInactivityTimer() { clearTimeout(inactivityTimer); clearTimeout(warningTimer); }
        function showInactivityWarning() { inactivityWarning.classList.add('show'); let count = 10; countdownSpan.textContent = count; warningTimer = setInterval(() => { count--; countdownSpan.textContent = count; if (count <= 0) { clearInterval(warningTimer); location.reload(); } }, 1000); }
        ['click', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(evt => document.addEventListener(evt, resetInactivityTimer));
        
        init();
    });
    </script>
</body>
</html>