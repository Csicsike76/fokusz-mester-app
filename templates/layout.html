<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Matektan√°r Projekt{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stilus.css') }}">

    {% block styles %}{% endblock %}
</head>
<body class="{{ request.cookies.get('theme', 'light-mode') }}">
    <video autoplay muted loop id="bg-video">
        <source src="{{ url_for('static', filename='video/video.mp4') }}" type="video/mp4">
    </video>

    <!-- Lebeg≈ë Akci√≥gombok -->
    <div class="floating-action-buttons">
        <a href="{{ url_for('fooldal') }}" class="fab-item" aria-label="F≈ëoldal"><img src="{{ url_for('static', filename='img/home_icon.svg') }}" alt="F≈ëoldal"></a>
        <button id="increase-font-size" class="fab-item" aria-label="Bet≈±m√©ret n√∂vel√©se">A+</button>
        <button id="decrease-font-size" class="fab-item" aria-label="Bet≈±m√©ret cs√∂kkent√©se">A-</button>
    </div>

    <!-- Chatbot Ikon √©s √úzenetbubor√©k -->
    <div id="chatbot-container">
        <div id="chatbot-message-bubble" class="chatbot-message-bubble" style="display: none;"></div>
        <img src="{{ url_for('static', filename='img/robot_tanar.png') }}" alt="Robot Tan√°r" id="chatbot-icon">
    </div>

    <div class="content-wrapper">
        {% include 'navigacio.html' %}

        <div class="container help-banner-container">
            <div class="collapsible-banner">
                <button class="collapsible-header">
                    <span>üìö Hogyan haszn√°ld ezt az oldalt? (Kattints a megnyit√°shoz)</span>
                    <span class="collapsible-arrow">‚ñº</span>
                </button>
                <div class="collapsible-content">
                    <p>Ez az oldal egy interakt√≠v tud√°st√°r. Haszn√°ld a men√ºt a navig√°l√°shoz, a keres≈ët a gyors el√©r√©shez, √©s fedezd fel a k√°rty√°kba rejtett interakt√≠v funkci√≥kat, mint a p√©ld√°k √©s a mesters√©ges intelligencia seg√≠ts√©g!</p>
                </div>
            </div>
        </div>

        {% block content %}{% endblock %}

        <footer>
            <div class="container footer-content">
                <img src="{{ url_for('static', filename='img/csicsike_logo.png') }}" alt="Csicsike Tud√°st√°r Log√≥" class="footer-logo">
                <p>CSICSIKE l√°bnyoma. ¬© 2025</p>
            </div>
        </footer>
    </div>

    <!-- Inaktivit√°s Modal -->
    <div id="inactivity-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button">√ó</span>
            <h2>Figyelem!</h2>
            <p>M√°r egy ideje inakt√≠v vagy. Szeretn√©d folytatni a munk√°t?</p>
            <p>A f√≥kuszid≈ë <span id="modal-timer">10</span> m√°sodperc m√∫lva lej√°r, √©s a rendszer automatikusan kijelentkeztet.</p>
            <button id="reset-timer-btn" class="btn btn-primary">Folytatom!</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/kereso_adatbazis.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chatbot.js') }}"></script>

    <script>
        const IS_AUTHENTICATED = {{ current_user.is_authenticated|tojson }};

        document.addEventListener('DOMContentLoaded', () => {
            // S√∂t√©t M√≥d
            const themeToggleButton = document.getElementById('dark-mode-toggle');
            if(themeToggleButton) {
                themeToggleButton.addEventListener('click', () => {
                    const isDarkMode = document.body.classList.toggle('dark-mode');
                    document.body.classList.toggle('light-mode', !isDarkMode);
                    document.cookie = `theme=${isDarkMode ? 'dark-mode' : 'light-mode'};path=/;max-age=31536000;SameSite=Lax`;
                });
            }

            // Keres≈ë Megjelen√≠t√©se
            const searchToggleBtn = document.getElementById('search-toggle-btn');
            const searchForm = document.getElementById('search-form');
            if(searchToggleBtn && searchForm) {
                searchToggleBtn.addEventListener('click', () => {
                    const isVisible = searchForm.style.display === 'flex';
                    searchForm.style.display = isVisible ? 'none' : 'flex';
                    if (!isVisible) {
                        document.getElementById('search-input').focus();
                    }
                });
            }

            // Sz√ºl≈ëi email
            const parentEmailBtn = document.getElementById('parent-email-btn');
            if(parentEmailBtn) {
                parentEmailBtn.addEventListener('click', () => {
                    fetch('/send_parent_email', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => { alert(data.message || data.error); })
                    .catch(() => alert('Hiba t√∂rt√©nt a kapcsolat sor√°n.'));
                });
            }

            // Inaktivit√°s figyel≈ë
            function inactivityTime() {
                let time;
                const modal = document.getElementById('inactivity-modal');
                if (!modal) return;

                const modalTimerSpan = document.getElementById('modal-timer');
                const resetTimerBtn = document.getElementById('reset-timer-btn');
                const closeButton = modal.querySelector('.close-button');
                let modalCountdown;
                let modalTimer = 10;

                function showModal() {
                    modal.style.display = 'block';
                    modalTimer = 10;
                    modalTimerSpan.textContent = modalTimer;
                    modalCountdown = setInterval(() => {
                        modalTimer--;
                        modalTimerSpan.textContent = modalTimer;
                        if (modalTimer <= 0) {
                            clearInterval(modalCountdown);
                            logout();
                        }
                    }, 1000);
                }

                function hideModal() {
                    modal.style.display = 'none';
                    clearInterval(modalCountdown);
                }

                function logout() { window.location.href = '/logout'; }
                function resetTimer() {
                    hideModal();
                    clearTimeout(time);
                    time = setTimeout(showModal, 600000); // 10 perc
                }

                window.onload = resetTimer;
                document.onmousemove = resetTimer;
                document.onkeypress = resetTimer;

                if(resetTimerBtn) resetTimerBtn.addEventListener('click', resetTimer);
                if(closeButton) closeButton.addEventListener('click', resetTimer);
            };

            if (IS_AUTHENTICATED) {
                inactivityTime();
            }

            // Nagy√≠t√°s / Bet≈±m√©ret
            const increaseFontBtn = document.getElementById('increase-font-size');
            const decreaseFontBtn = document.getElementById('decrease-font-size');
            if (increaseFontBtn && decreaseFontBtn) {
                increaseFontBtn.addEventListener('click', () => {
                    let currentSize = parseFloat(getComputedStyle(document.body).fontSize);
                    document.body.style.fontSize = (currentSize + 1) + 'px';
                });
                decreaseFontBtn.addEventListener('click', () => {
                    let currentSize = parseFloat(getComputedStyle(document.body).fontSize);
                    document.body.style.fontSize = (currentSize - 1) + 'px';
                });
            }

            // "Hogyan haszn√°ld..." banner
            const collapsibleHeader = document.querySelector('.collapsible-header');
            if (collapsibleHeader) {
                collapsibleHeader.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const content = this.nextElementSibling;
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            }

            // Lecke-specifikus gombok
            document.querySelectorAll('.example-toggle').forEach(button => {
                button.addEventListener('click', () => {
                    const card = button.closest('.workshop-card, .formula-card');
                    if (card) {
                        const exampleArea = card.querySelector('.example-area');
                        if (exampleArea) {
                            const isVisible = exampleArea.style.display === 'block';
                            exampleArea.style.display = isVisible ? 'none' : 'block';
                            button.textContent = isVisible ? button.dataset.showText : button.dataset.hideText;
                        }
                    }
                });
            });

            document.querySelectorAll('.gemini-help-btn').forEach(button => {
                const originalText = button.innerHTML;
                button.addEventListener('click', () => {
                    const card = button.closest('.workshop-card, .formula-card');
                    if (card) {
                        const formulaName = card.dataset.formulaName || 'err≈ël a t√©m√°r√≥l';
                        const formulaExample = card.dataset.formulaExample || 'egy kapcsol√≥d√≥ p√©ld√°n';
                        const prompt = `Viselkedj √∫gy, mint egy t√ºrelmes √©s seg√≠t≈ëk√©sz tan√°r! Egy di√°k seg√≠ts√©get k√©rt a k√∂vetkez≈ëvel kapcsolatban: "${formulaName}".\nA feladatod a k√∂vetkez≈ë 3 l√©p√©sben:\n1. Magyar√°zd el l√©p√©sr≈ël l√©p√©sre, egyszer≈± szavakkal, hogy mit jelent ez a koncepci√≥.\n2. Vezesd v√©gig a di√°kot a k√∂vetkez≈ë feladaton: "${formulaExample}" Magyar√°zd el minden l√©p√©sn√©l, hogy mit √©s mi√©rt csin√°lsz!\n3. Adj a di√°knak 3 √∫j, egyszer≈±, gyakorl√≥ feladatot (megold√°s n√©lk√ºl), amivel begyakorolhatja ezt a t√©mak√∂rt.\nA st√≠lusod legyen b√°tor√≠t√≥ √©s pozit√≠v! Kezdd a v√°laszt √≠gy: "Szia! Nagyszer≈±, hogy seg√≠ts√©get k√©rt√©l a(z) ${formulaName} meg√©rt√©s√©hez. N√©zz√ºk meg egy√ºtt l√©p√©sr≈ël l√©p√©sre!"`;
                        navigator.clipboard.writeText(prompt.trim()).then(() => {
                            button.innerHTML = '‚úÖ Prompt m√°solva!';
                            window.open('https://gemini.google.com/app', '_blank');
                            setTimeout(() => { button.innerHTML = originalText; }, 3000);
                        });
                    }
                });
            });

            document.querySelectorAll('.feedback-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const parent = button.parentElement;
                    parent.querySelectorAll('.feedback-btn').forEach(btn => btn.style.transform = 'scale(1)');
                    button.style.transform = 'scale(1.3)';
                });
            });
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>